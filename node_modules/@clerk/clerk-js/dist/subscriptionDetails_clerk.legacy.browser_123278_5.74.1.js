"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["965"],{51367:function(e,t,n){n.r(t),n.d(t,{SubscriptionDetails:()=>v}),n(92037),n(65223),n(38062),n(50725);var i=n(79109),a=n(83799),o=n(69144),l=n(13559),r=n(1677),c=n(29629),s=n(48216),u=n(2672),p=n(81102),d=n(33009),m=n(88870),b=n(39082),h=n(28e3),y=n(11576),D=n(89888),g=n(95746);let S=o.createContext({confirmationOpen:!1,setConfirmationOpen:()=>{},subscription:null,setSubscription:()=>{}}),v=e=>(0,i.tZ)(D.Flow.Root,{flow:"subscriptionDetails",children:(0,i.tZ)(D.Flow.Part,{children:(0,i.tZ)(p.Drawer.Content,{children:(0,i.tZ)(r.I.Provider,{value:{componentName:"SubscriptionDetails",...e},children:(0,i.tZ)(y.SubscriberTypeContext.Provider,{value:e.for,children:(0,i.tZ)(C,{...e})})})})})});function x(e){let{data:t,isLoading:n}=(0,y.useSubscriptions)(),i=null==t?void 0:t.find(e=>"active"===e.status),a=null==t?void 0:t.find(e=>"upcoming"===e.status),o=null==t?void 0:t.find(e=>"past_due"===e.status);if((null==e?void 0:e.or)==="throw"&&!i&&!o)throw Error("No active or past due subscription found");return{upcomingSubscription:a,pastDueSubscription:o,activeSubscription:i,anySubscription:a||i||o,isLoading:n}}let C=e=>{let{organization:t}=(0,a.o8)(),[n,l]=(0,o.useState)(null),[r,c]=(0,o.useState)(!1),{buttonPropsForPlan:s,isDefaultPlanImplicitlyActiveOrUpcoming:u}=(0,y.usePlansContext)(),{data:d,isLoading:m}=(0,y.useSubscriptions)(),{activeSubscription:b,pastDueSubscription:h}=x();return m?(0,i.tZ)(D.Spinner,{sx:{margin:"auto"}}):b||h?(0,i.BX)(S.Provider,{value:{subscription:n,setSubscription:l,confirmationOpen:r,setConfirmationOpen:c},children:[(0,i.tZ)(p.Drawer.Header,{title:(0,D.localizationKeys)("commerce.subscriptionDetails.title")}),(0,i.tZ)(p.Drawer.Body,{sx:e=>({display:"flex",flexDirection:"column",flex:1,overflowY:"auto",padding:e.space.$4,gap:e.space.$4}),children:null==d?void 0:d.map(t=>(0,i.tZ)(f,{subscription:t,...e},t.id))}),(0,i.tZ)(Z,{})]}):null},Z=(0,u.withCardStateProvider)(()=>{let e=(0,y.useSubscriberTypeContext)(),{organization:t}=(0,a.o8)(),{isLoading:n,error:l,setError:c,setLoading:d,setIdle:b}=(0,u.useCardState)(),{subscription:h,confirmationOpen:g,setConfirmationOpen:v}=(0,o.useContext)(S),{anySubscription:C}=x({or:"throw"}),{setIsOpen:Z}=(0,p.useDrawerContext)(),{onSubscriptionCancel:w}=(0,r.F)(),f=(0,o.useCallback)(e=>v(e),[v]),K=(0,o.useCallback)(async()=>{h&&(c(void 0),d(),await h.cancel({orgId:"org"===e?null==t?void 0:t.id:void 0}).then(()=>{null==w||w(),Z&&Z(!1)}).catch(e=>{(0,m.S3)(e,[],c)}).finally(()=>{b()}))},[h,c,d,e,null==t?void 0:t.id,w,Z,b]);return C.plan.hasBaseFee&&"past_due"!==C.status?(0,i.BX)(p.Drawer.Footer,{children:[(0,i.tZ)(z,{}),(0,i.tZ)(p.Drawer.Confirmation,{open:g,onOpenChange:f,actionsSlot:(0,i.BX)(i.HY,{children:[!n&&(0,i.tZ)(D.Button,{variant:"ghost",size:"sm",textVariant:"buttonLarge",onClick:()=>{b(),c(void 0),f(!1)},localizationKey:(0,D.localizationKeys)("commerce.keepSubscription")}),(0,i.tZ)(D.Button,{variant:"solid",colorScheme:"danger",size:"sm",textVariant:"buttonLarge",isLoading:n,onClick:()=>void K(),localizationKey:(0,D.localizationKeys)("commerce.cancelSubscription")})]}),children:h?(0,i.BX)(i.HY,{children:[(0,i.tZ)(D.Heading,{elementDescriptor:D.descriptors.drawerConfirmationTitle,as:"h2",textVariant:"h3",localizationKey:(0,D.localizationKeys)("commerce.cancelSubscriptionTitle",{plan:"".concat("upcoming"===h.status?"upcoming ":"").concat(h.plan.name)})}),(0,i.tZ)(D.Text,{elementDescriptor:D.descriptors.drawerConfirmationDescription,colorScheme:"secondary",localizationKey:"upcoming"===h.status?(0,D.localizationKeys)("commerce.cancelSubscriptionNoCharge"):(0,D.localizationKeys)("commerce.cancelSubscriptionAccessUntil",{plan:h.plan.name,date:h.periodEndDate})}),(0,i.tZ)(s.m,{children:l})]}):null})]}):null});function z(){let{anySubscription:e,activeSubscription:t,upcomingSubscription:n}=x({or:"throw"});return t?(0,i.BX)(h.a.Root,{children:[(0,i.BX)(h.a.Group,{children:[(0,i.tZ)(h.a.Title,{description:(0,D.localizationKeys)("commerce.subscriptionDetails.currentBillingCycle")}),(0,i.tZ)(h.a.Description,{text:"month"===t.planPeriod?(0,D.localizationKeys)("commerce.monthly"):(0,D.localizationKeys)("commerce.annually")})]}),(0,i.BX)(h.a.Group,{children:[(0,i.tZ)(h.a.Title,{description:(0,D.localizationKeys)("commerce.subscriptionDetails.nextPaymentOn")}),(0,i.tZ)(h.a.Description,{text:n?(0,b.p)(n.periodStartDate):e.periodEndDate?(0,b.p)(e.periodEndDate):"-"})]}),(0,i.BX)(h.a.Group,{children:[(0,i.tZ)(h.a.Title,{description:(0,D.localizationKeys)("commerce.subscriptionDetails.nextPaymentAmount")}),(0,i.tZ)(h.a.Description,{prefix:e.plan.currency,text:"".concat(e.plan.currencySymbol).concat("month"===e.planPeriod?e.plan.amountFormatted:e.plan.annualAmountFormatted)})]})]}):null}let w=e=>{let{subscription:t}=e,{portalRoot:n}=(0,r.F)(),{__internal_openCheckout:c}=(0,a.cL)(),s=(0,y.useSubscriberTypeContext)(),{setIsOpen:u}=(0,p.useDrawerContext)(),{revalidateAll:m}=(0,y.usePlansContext)(),{setSubscription:b,setConfirmationOpen:h}=(0,o.useContext)(S),g=(0,l.N2)(e=>e({permission:"org:sys_billing:manage"})),v="user"===s||g,x=("month"===t.planPeriod&&t.plan.annualMonthlyAmount>0||"annual"===t.planPeriod)&&"past_due"!==t.status,C=!t.plan.hasBaseFee,Z=null===t.canceledAtDate&&!C&&"past_due"!==t.status,z=null!==t.canceledAtDate&&!C,w=(0,o.useCallback)(e=>{u&&u(!1),c({...e,onSubscriptionComplete:()=>{m()},portalRoot:n})},[c,m,n,u]),f=o.useMemo(()=>v?[x?{label:"month"===t.planPeriod?(0,D.localizationKeys)("commerce.switchToAnnualWithAnnualPrice",{price:t.plan.annualAmountFormatted,currency:t.plan.currencySymbol}):(0,D.localizationKeys)("commerce.switchToMonthlyWithPrice",{price:t.plan.amountFormatted,currency:t.plan.currencySymbol}),onClick:()=>{w({planId:t.plan.id,planPeriod:"month"===t.planPeriod?"annual":"month",subscriberType:s})}}:null,Z?{isDestructive:!0,label:(0,D.localizationKeys)("commerce.cancelSubscription"),onClick:()=>{b(t),h(!0)}}:null,z?{label:(0,D.localizationKeys)("commerce.reSubscribe"),onClick:()=>{w({planId:t.plan.id,planPeriod:t.planPeriod,subscriberType:s})}}:null].filter(e=>null!==e):[],[x,t,Z,w,s,b,v,z,h]);return 0===f.length?null:(0,i.tZ)(d.a,{variant:"bordered",actions:f})},f=e=>{let{subscription:t}=e,{t:n}=(0,D.useLocalizations)();return(0,i.BX)(D.Col,{elementDescriptor:D.descriptors.subscriptionDetailsCard,sx:e=>({borderRadius:e.radii.$md,boxShadow:e.shadows.$tableBodyShadow}),children:[(0,i.BX)(D.Col,{elementDescriptor:D.descriptors.subscriptionDetailsCardBody,gap:3,sx:e=>({padding:e.space.$3}),children:[(0,i.BX)(D.Flex,{elementDescriptor:D.descriptors.subscriptionDetailsCardHeader,align:"center",gap:2,children:[t.plan.avatarUrl?(0,i.tZ)(c.q,{boxElementDescriptor:D.descriptors.planDetailAvatar,size:e=>40,title:t.plan.name,rounded:!1,imageUrl:t.plan.avatarUrl}):null,(0,i.tZ)(D.Text,{elementDescriptor:D.descriptors.subscriptionDetailsCardTitle,variant:"h2",sx:e=>({fontSize:e.fontSizes.$lg,fontWeight:e.fontWeights.$semibold,color:e.colors.$colorForeground,marginInlineEnd:"auto"}),children:t.plan.name}),(0,i.tZ)(g.u,{subscription:t,elementDescriptor:D.descriptors.subscriptionDetailsCardBadge})]}),(0,i.BX)(D.Flex,{elementDescriptor:D.descriptors.subscriptionDetailsCardActions,justify:"between",align:"center",children:[(0,i.tZ)(D.Text,{variant:"body",colorScheme:"secondary",sx:e=>({fontWeight:e.fontWeights.$medium,textTransform:"lowercase"}),children:"month"===t.planPeriod?"".concat(t.plan.currencySymbol).concat(t.plan.amountFormatted," / ").concat(n((0,D.localizationKeys)("commerce.month"))):"".concat(t.plan.currencySymbol).concat(t.plan.annualAmountFormatted," / ").concat(n((0,D.localizationKeys)("commerce.year")))}),(0,i.tZ)(w,{subscription:t})]})]}),t.pastDueAt?(0,i.tZ)(K,{label:(0,D.localizationKeys)("commerce.subscriptionDetails.pastDueAt"),value:(0,b.p)(t.pastDueAt)}):null,"active"===t.status?(0,i.BX)(i.HY,{children:[(0,i.tZ)(K,{label:(0,D.localizationKeys)("commerce.subscriptionDetails.subscribedOn"),value:(0,b.p)(t.createdAt)}),t.periodEndDate&&(0,i.tZ)(K,{label:t.canceledAtDate?(0,D.localizationKeys)("commerce.subscriptionDetails.endsOn"):(0,D.localizationKeys)("commerce.subscriptionDetails.renewsAt"),value:(0,b.p)(t.periodEndDate)})]}):null,"upcoming"===t.status?(0,i.tZ)(K,{label:(0,D.localizationKeys)("commerce.subscriptionDetails.beginsOn"),value:(0,b.p)(t.periodStartDate)}):null]})},K=e=>{let{label:t,value:n}=e;return(0,i.BX)(D.Flex,{elementDescriptor:D.descriptors.subscriptionDetailsDetailRow,justify:"between",align:"center",sx:e=>({paddingInline:e.space.$3,paddingBlock:e.space.$3,borderBlockStartWidth:e.borderWidths.$normal,borderBlockStartStyle:e.borderStyles.$solid,borderBlockStartColor:e.colors.$borderAlpha100}),children:[(0,i.tZ)(D.Text,{elementDescriptor:D.descriptors.subscriptionDetailsDetailRowLabel,localizationKey:t}),(0,i.tZ)(D.Text,{elementDescriptor:D.descriptors.subscriptionDetailsDetailRowValue,colorScheme:"secondary",children:n})]})}},95746:function(e,t,n){n.d(t,{u:()=>r});var i=n(79109),a=n(89888);let o={active:"badge__activePlan",upcoming:"badge__upcomingPlan",past_due:"badge__pastDuePlan"},l={active:"secondary",upcoming:"primary",past_due:"warning"},r=e=>{let{subscription:t,elementDescriptor:n}=e;return(0,i.tZ)(a.Badge,{elementDescriptor:n,colorScheme:l[t.status],localizationKey:(0,a.localizationKeys)(o[t.status])})}}}]);